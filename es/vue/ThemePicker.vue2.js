/*!
 * ***********************************
 * @ldesign/color v1.0.0           *
 * Built with rollup               *
 * Build time: 2024-10-21 14:32:31 *
 * Build mode: production          *
 * Minified: No                    *
 * ***********************************
 */import{defineComponent as se,inject as H,computed as m,ref as v,createElementBlock as c,onMounted as ie,onUnmounted as ce,watch as W,openBlock as i,createElementVNode as a,createBlock as ne,Teleport as me,createVNode as de,Transition as pe,withCtx as he,createCommentVNode as f,withModifiers as X,normalizeStyle as Y,withDirectives as C,vModelText as b,toDisplayString as y,withKeys as ve,createTextVNode as fe,Fragment as ke,renderList as ye,normalizeClass as _e,nextTick as we}from"vue";import{getLocale as Ce}from"../locales/index.js";import{ColorPluginSymbol as be}from"../plugin/index.js";import{useTheme as Te}from"./useTheme.js";const ge=["title"],xe=["stroke"],Be=["fill"],Ee=["fill"],Le=["fill"],Pe=["fill"],Ve={key:0,class:"ld-theme-picker__search"},Fe=["placeholder"],Ae={class:"ld-theme-picker__content"},Se={key:0,class:"ld-theme-picker__custom"},Ne={class:"ld-theme-picker__label"},qe={class:"ld-theme-picker__custom-input"},ze={key:0,class:"ld-theme-picker__add-theme"},$e={class:"ld-theme-picker__label"},Me={class:"ld-theme-picker__add-input"},Ue=["placeholder"],Ke=["disabled"],Re={class:"ld-theme-picker__presets"},De={class:"ld-theme-picker__label"},Ie={style:{"font-size":"10px",color:"#999","margin-left":"8px"}},je={class:"ld-theme-picker__grid"},He=["title","onClick"],We={key:0,class:"ld-theme-picker__check",width:"16",height:"16",viewBox:"0 0 16 16"},Xe=["onClick"],Ye=["title","onClick"];var Ze=se({__name:"ThemePicker",props:{modelValue:{type:String,required:!1},showArrow:{type:Boolean,required:!1,default:!0},showSearch:{type:Boolean,required:!1,default:!1},showCustom:{type:Boolean,required:!1,default:!1},showAddCustomTheme:{type:Boolean,required:!1,default:!1},showRemoveButton:{type:Boolean,required:!1,default:!0},prefix:{type:String,required:!1,default:"ld"},storageKey:{type:String,required:!1}},emits:["update:modelValue","change"],setup(Z,{emit:G}){const x=Z,B=G,o=H(be,void 0),S=H("locale",null),z=m(()=>o?.currentLocale?.value?o.currentLocale.value:S&&S.value?S.value:"zh-CN"),J=m(()=>Ce(z.value)),u=(e,l)=>{const t=e.split(".");let r=J.value;for(const h of t)if(r&&typeof r=="object")r=r[h];else return l||e;return typeof r=="string"?r:l||e},E=v(),d=v(!1),L=v(""),n=v("#1890ff"),_=v(""),p=v("#1890ff"),$=v({}),k=v(""),{presets:O,primaryColor:M,themeName:w,applyTheme:U,applyPresetTheme:K,restoreTheme:Q}=Te({prefix:x.prefix,storageKey:x.storageKey}),R=m(()=>o?o.getSortedPresets():O.value),P=m(()=>x.modelValue||M.value||"#1890ff"),T=m(()=>{const e=P.value,l=Number.parseInt(e.slice(1,3),16),t=Number.parseInt(e.slice(3,5),16),r=Number.parseInt(e.slice(5,7),16);return(l*299+t*587+r*114)/1e3>128?"#595959":e}),ee=m(()=>{const e=k.value||w.value,l=R.value.find(t=>t.name===e);if(l){const t=`theme.presets.${l.name}`;return u(t,l.label)}return u("theme.title","Theme Color")}),V=m(()=>k.value||w.value),le=m(()=>{const e=[...R.value];return!e.some(l=>l.color.toLowerCase()===(P.value||"").toLowerCase())&&P.value&&e.unshift({name:"custom-current",label:u("theme.custom","Current Color"),color:P.value,custom:!0}),e}),te=m(()=>{let e=le.value;if(L.value){const l=L.value.toLowerCase();e=e.filter(t=>t.label.toLowerCase().includes(l)||t.name.toLowerCase().includes(l)||t.color.toLowerCase().includes(l))}return[...e].sort((l,t)=>{const r=l.order??9999,h=t.order??9999;return r-h})}),D=()=>{if(!E.value)return;const e=E.value.getBoundingClientRect(),l=360,t=window.innerWidth,r=window.innerHeight,h=296,s=16,j=r-e.bottom-s,ue=e.top-s;let A=e.bottom+s;j<l&&ue>j&&(A=e.top-l-s),A=Math.max(s,Math.min(A,r-l-s));let g=e.left+e.width/2-h/2;g<s?g=s:g+h>t-s&&(g=t-h-s),$.value={position:"fixed",top:`${A}px`,left:`${g}px`,width:`${h}px`,maxWidth:`calc(100vw - ${s*2}px)`,zIndex:9999}},ae=()=>{d.value=!d.value,d.value&&we(()=>D())},N=async e=>{try{k.value=e.name,o?await o.applyPresetTheme(e.name):await K(e.name),B("update:modelValue",e.color),B("change",e.color,e)}catch(l){console.error("[ThemePicker] Failed to apply preset theme:",l),k.value=w.value}d.value=!1},q=async()=>{if(n.value){try{o?await o.applyTheme(n.value):await U(n.value),B("update:modelValue",n.value),B("change",n.value)}catch(e){console.error("[ThemePicker] Failed to apply custom color:",e)}d.value=!1}},oe=async()=>{if(!_.value||!p.value)return;const e=_.value,l=p.value;try{o&&typeof o.addCustomTheme=="function"?(o.addCustomTheme({name:e,label:e,color:l,custom:!0}),_.value="",p.value="#1890ff",await N({name:e,label:e,color:l,custom:!0})):console.warn("[ThemePicker] Color plugin not found. Cannot add custom theme.")}catch(t){console.error("[ThemePicker] Failed to add custom theme:",t),console.error("[ThemePicker] Failed to add custom theme:",t instanceof Error?t.message:"Failed to add theme")}},re=async e=>{try{o&&typeof o.removeCustomTheme=="function"?(o.removeCustomTheme(e),w.value===e&&(o.applyPresetTheme?await o.applyPresetTheme("blue"):await K("blue"))):console.warn("[ThemePicker] Color plugin not found. Cannot remove custom theme.")}catch(l){console.error("[ThemePicker] Failed to remove custom theme:",l),console.error("[ThemePicker] Failed to remove theme:",l instanceof Error?l.message:"Failed to remove theme")}},I=e=>{E.value?.contains(e.target)||(d.value=!1)},F=()=>{d.value&&D()};return ie(()=>{Q(),k.value=w.value,document.addEventListener("click",I),window.addEventListener("resize",F),window.addEventListener("scroll",F)}),ce(()=>{document.removeEventListener("click",I),window.removeEventListener("resize",F),window.removeEventListener("scroll",F)}),W(()=>x.modelValue,e=>{e&&e!==M.value&&U(e)}),W(w,e=>{e&&e!==k.value&&(k.value=e)}),(e,l)=>(i(),c("div",{ref_key:"pickerRef",ref:E,class:"ld-theme-picker"},[a("button",{class:"ld-theme-picker__trigger",title:ee.value,onClick:ae},[(i(),c("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:T.value,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[a("circle",{cx:"13.5",cy:"6.5",r:".5",fill:T.value},null,8,Be),a("circle",{cx:"17.5",cy:"10.5",r:".5",fill:T.value},null,8,Ee),a("circle",{cx:"8.5",cy:"7.5",r:".5",fill:T.value},null,8,Le),a("circle",{cx:"6.5",cy:"12.5",r:".5",fill:T.value},null,8,Pe),l[7]||(l[7]=a("path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z"},null,-1))],8,xe))],8,ge),(i(),ne(me,{to:"body"},[de(pe,{name:"ld-theme-picker-fade"},{default:he(()=>[d.value?(i(),c("div",{key:0,class:"ld-theme-picker__dropdown",style:Y($.value),onClick:l[6]||(l[6]=X(()=>{},["stop"]))},[e.showSearch?(i(),c("div",Ve,[C(a("input",{"onUpdate:modelValue":l[0]||(l[0]=t=>L.value=t),type:"text",placeholder:u("theme.searchPlaceholder","Search colors..."),class:"ld-theme-picker__search-input"},null,8,Fe),[[b,L.value]])])):f("v-if",!0),a("div",Ae,[e.showCustom?(i(),c("div",Se,[a("label",Ne,y(u("theme.customColor","Custom Color")),1),a("div",qe,[C(a("input",{"onUpdate:modelValue":l[1]||(l[1]=t=>n.value=t),type:"color",class:"ld-theme-picker__color-input",onChange:q},null,544),[[b,n.value]]),C(a("input",{"onUpdate:modelValue":l[2]||(l[2]=t=>n.value=t),type:"text",placeholder:"#000000",class:"ld-theme-picker__hex-input",onKeyup:ve(q,["enter"])},null,544),[[b,n.value]]),a("button",{class:"ld-theme-picker__apply-btn",onClick:q},y(u("theme.apply","Apply")),1)]),f(" \u6DFB\u52A0\u81EA\u5B9A\u4E49\u4E3B\u9898 "),e.showAddCustomTheme?(i(),c("div",ze,[a("label",$e,y(u("theme.addCustomTheme","Add Custom Theme")),1),a("div",Me,[C(a("input",{"onUpdate:modelValue":l[3]||(l[3]=t=>_.value=t),type:"text",placeholder:u("theme.themeName","Theme name"),class:"ld-theme-picker__name-input"},null,8,Ue),[[b,_.value]]),C(a("input",{"onUpdate:modelValue":l[4]||(l[4]=t=>p.value=t),type:"color",class:"ld-theme-picker__color-input"},null,512),[[b,p.value]]),C(a("input",{"onUpdate:modelValue":l[5]||(l[5]=t=>p.value=t),type:"text",placeholder:"#000000",class:"ld-theme-picker__hex-input"},null,512),[[b,p.value]]),a("button",{class:"ld-theme-picker__add-btn",disabled:!_.value||!p.value,onClick:oe},y(u("theme.add","Add")),9,Ke)])])):f("v-if",!0)])):f("v-if",!0),a("div",Re,[a("label",De,[fe(y(u("theme.selectThemeColor","Select Theme Color"))+" ",1),a("span",Ie," ("+y(z.value)+") ",1)]),a("div",je,[(i(!0),c(ke,null,ye(te.value,t=>(i(),c("div",{key:`${t.name}-${t.color}`,class:_e(["ld-theme-picker__preset",{"is-active":t.name===V.value||!V.value&&t.custom,"is-custom":t.custom}])},[a("span",{class:"ld-theme-picker__preset-color",style:Y({backgroundColor:t.color}),title:t.label,onClick:r=>N(t)},[t.name===V.value||!V.value&&t.custom?(i(),c("svg",We,[...l[8]||(l[8]=[a("path",{d:"M3 8L6 11L13 4",stroke:"white","stroke-width":"2",fill:"none"},null,-1)])])):f("v-if",!0)],12,He),a("span",{class:"ld-theme-picker__preset-label",onClick:r=>N(t)},y(u(`theme.presets.${t.name}`,t.label)),9,Xe),f(" \u5220\u9664\u6309\u94AE\uFF08\u4EC5\u81EA\u5B9A\u4E49\u4E3B\u9898\uFF09 "),t.custom&&e.showRemoveButton?(i(),c("button",{key:0,class:"ld-theme-picker__remove-btn",title:u("theme.remove","Remove"),onClick:X(r=>re(t.name),["stop"])}," \xD7 ",8,Ye)):f("v-if",!0)],2))),128))])])])],4)):f("v-if",!0)]),_:1})]))],512))}});/*! End of @ldesign/color | Powered by @ldesign/builder */export{Ze as default};
//# sourceMappingURL=ThemePicker.vue2.js.map
