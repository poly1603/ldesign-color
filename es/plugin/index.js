/*!
 * ***********************************
 * @ldesign/color v1.0.0           *
 * Built with rollup               *
 * Build time: 2024-10-21 14:32:31 *
 * Build mode: production          *
 * Minified: No                    *
 * ***********************************
 */import{ref as T,inject as G}from"vue";import{getLocale as K}from"../locales/index.js";import{presetThemes as N}from"../themes/presets.js";import{ThemeManager as L}from"../themes/themeManager.js";const v=Symbol("ColorPlugin"),S=r=>r&&typeof r=="object"&&"value"in r&&"_rawValue"in r;function $(r){if(r.locale)return S(r.locale)?r.locale:T(r.locale);try{const l=G("app-locale",null);if(l&&l.value)return l}catch{}const n=T("zh-CN");if(typeof window<"u"){const l=localStorage.getItem("app-locale");l&&(n.value=l);const m=u=>{const t=u;t.detail?.locale&&(n.value=t.detail.locale)};window.addEventListener("app:locale-changed",m),window.addEventListener("unload",()=>{window.removeEventListener("app:locale-changed",m)},{once:!0})}return n}function C(r={}){const n=$(r),l=new WeakMap,m=()=>{const e={value:n.value};let o=l.get(e);return o||(o=K(n.value),l.set(e,o)),o},u={get value(){return m()}},t={prefix:r.prefix||"ld",storageKey:r.storageKey||"ldesign-theme",persistence:r.persistence!==!1,storageType:r.storageType||"localStorage",storage:r.storage,autoApply:r.autoApply!==!1,defaultTheme:r.defaultTheme||"blue",includeSemantics:r.includeSemantics!==!1,includeGrays:r.includeGrays!==!1,presets:r.presets||"all",disabledPresets:r.disabledPresets||[],customThemes:r.customThemes||[],hooks:r.hooks,nameMap:r.nameMap};let a=[];t.presets==="all"?a=N.filter(e=>!t.disabledPresets.includes(e.name)):a=t.presets,t.customThemes.length>0&&(a=[...a,...t.customThemes]);const p=e=>[...e].sort((o,s)=>{const i=o.order??9999,P=s.order??9999;return i-P});a=p(a);const c=new L({prefix:t.prefix,storageKey:t.storageKey,autoApply:!1,includeSemantics:t.includeSemantics,includeGrays:t.includeGrays,nameMap:t.nameMap}),d={async getItem(e){try{return t.storage?await t.storage.getItem(e):typeof window>"u"?null:(t.storageType==="sessionStorage"?window.sessionStorage:window.localStorage).getItem(e)}catch(o){return t.hooks?.onError?.(o),null}},async setItem(e,o){try{if(t.storage){await t.storage.setItem(e,o);return}if(typeof window>"u")return;(t.storageType==="sessionStorage"?window.sessionStorage:window.localStorage).setItem(e,o)}catch(s){t.hooks?.onError?.(s)}},async removeItem(e){try{if(t.storage){await t.storage.removeItem(e);return}if(typeof window>"u")return;(t.storageType==="sessionStorage"?window.sessionStorage:window.localStorage).removeItem(e)}catch(o){t.hooks?.onError?.(o)}}},h=async(e,o)=>{const s=c.getCurrentTheme();try{if(t.hooks?.beforeChange&&await t.hooks.beforeChange({primaryColor:e,themeName:e},s)===!1)throw new Error("Theme change cancelled by beforeChange hook");const i=c.applyTheme(e,{...o,prefix:o?.prefix||t.prefix,includeSemantics:o?.includeSemantics??t.includeSemantics,includeGrays:o?.includeGrays??t.includeGrays,nameMap:o?.nameMap||t.nameMap});return t.persistence&&(await d.setItem(t.storageKey,JSON.stringify(i)),await t.hooks?.onSave?.(i)),await t.hooks?.afterChange?.(i),i}catch(i){throw t.hooks?.onError?.(i),i}},k=async(e,o)=>{if(!a.find(s=>s.name===e))throw new Error(`Preset theme "${e}" not found`);return h(e,o)},y=`${t.storageKey}-custom-themes`,E=async()=>{try{const e=await d.getItem(y);e&&(JSON.parse(e).forEach(o=>{a.find(s=>s.name===o.name)||a.push({...o,custom:!0})}),a=p(a))}catch(e){t.hooks?.onError?.(e)}},w=async()=>{try{const e=a.filter(o=>o.custom);await d.setItem(y,JSON.stringify(e))}catch(e){t.hooks?.onError?.(e)}},I=async()=>{try{await E();const e=await d.getItem(t.storageKey);if(e){const o=JSON.parse(e);await h(o.themeName||o.primaryColor),await t.hooks?.onLoad?.(o)}else t.defaultTheme&&await h(t.defaultTheme)}catch(e){t.hooks?.onError?.(e)}},b=e=>{if(a.find(s=>s.name===e.name))throw new Error(`Theme "${e.name}" already exists`);const o={...e,custom:!0,order:e.order??Math.max(...a.map(s=>s.order??0))+1};a.push(o),a=p(a),w()},x=e=>{const o=a.findIndex(s=>s.name===e&&s.custom);if(o===-1)throw new Error(`Custom theme "${e}" not found`);a.splice(o,1),w()},M=()=>p(a),g=[],f={manager:c,presets:a,options:{...t,locale:n.value},currentLocale:n,localeMessages:u,applyTheme:h,applyPresetTheme:k,getCurrentTheme:()=>c.getCurrentTheme(),onChange:e=>{const o=c.onChange(e);return g.push(o),o},addCustomTheme:b,removeCustomTheme:x,getSortedPresets:M,destroy(){g.forEach(e=>e()),g.length=0,c.destroy&&c.destroy()},install(e){if(!S(r.locale)){const o=e._context?.provides?.locale;o&&o.value!==void 0||e.provide("locale",n)}if(e.provide(v,f),e.provide("color",f),e.provide("color-locale",u),e.config.globalProperties.$color=f,t.autoApply&&typeof window<"u"){const o=setTimeout(()=>{I()},0);g.push(()=>clearTimeout(o))}}};return f}/*! End of @ldesign/color | Powered by @ldesign/builder */export{v as ColorPluginSymbol,C as createColorPlugin,C as default};
//# sourceMappingURL=index.js.map
