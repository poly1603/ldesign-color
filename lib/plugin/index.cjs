"use strict";/*!
 * ***********************************
 * @ldesign/color v1.0.0           *
 * Built with rollup               *
 * Build time: 2024-10-21 14:32:31 *
 * Build mode: production          *
 * Minified: No                    *
 * ***********************************
 */Object.defineProperty(exports,"__esModule",{value:!0});var f=require("vue"),G=require("../locales/index.cjs"),K=require("../themes/presets.cjs"),N=require("../themes/themeManager.cjs");const T=Symbol("ColorPlugin"),S=a=>a&&typeof a=="object"&&"value"in a&&"_rawValue"in a;function L(a){if(a.locale)return S(a.locale)?a.locale:f.ref(a.locale);try{const l=f.inject("app-locale",null);if(l&&l.value)return l}catch{}const n=f.ref("zh-CN");if(typeof window<"u"){const l=localStorage.getItem("app-locale");l&&(n.value=l);const u=m=>{const t=m;t.detail?.locale&&(n.value=t.detail.locale)};window.addEventListener("app:locale-changed",u),window.addEventListener("unload",()=>{window.removeEventListener("app:locale-changed",u)},{once:!0})}return n}function C(a={}){const n=L(a),l=new WeakMap,u=()=>{const e={value:n.value};let r=l.get(e);return r||(r=G.getLocale(n.value),l.set(e,r)),r},m={get value(){return u()}},t={prefix:a.prefix||"ld",storageKey:a.storageKey||"ldesign-theme",persistence:a.persistence!==!1,storageType:a.storageType||"localStorage",storage:a.storage,autoApply:a.autoApply!==!1,defaultTheme:a.defaultTheme||"blue",includeSemantics:a.includeSemantics!==!1,includeGrays:a.includeGrays!==!1,presets:a.presets||"all",disabledPresets:a.disabledPresets||[],customThemes:a.customThemes||[],hooks:a.hooks,nameMap:a.nameMap};let o=[];t.presets==="all"?o=K.presetThemes.filter(e=>!t.disabledPresets.includes(e.name)):o=t.presets,t.customThemes.length>0&&(o=[...o,...t.customThemes]);const d=e=>[...e].sort((r,s)=>{const i=r.order??9999,P=s.order??9999;return i-P});o=d(o);const c=new N.ThemeManager({prefix:t.prefix,storageKey:t.storageKey,autoApply:!1,includeSemantics:t.includeSemantics,includeGrays:t.includeGrays,nameMap:t.nameMap}),p={async getItem(e){try{return t.storage?await t.storage.getItem(e):typeof window>"u"?null:(t.storageType==="sessionStorage"?window.sessionStorage:window.localStorage).getItem(e)}catch(r){return t.hooks?.onError?.(r),null}},async setItem(e,r){try{if(t.storage){await t.storage.setItem(e,r);return}if(typeof window>"u")return;(t.storageType==="sessionStorage"?window.sessionStorage:window.localStorage).setItem(e,r)}catch(s){t.hooks?.onError?.(s)}},async removeItem(e){try{if(t.storage){await t.storage.removeItem(e);return}if(typeof window>"u")return;(t.storageType==="sessionStorage"?window.sessionStorage:window.localStorage).removeItem(e)}catch(r){t.hooks?.onError?.(r)}}},h=async(e,r)=>{const s=c.getCurrentTheme();try{if(t.hooks?.beforeChange&&await t.hooks.beforeChange({primaryColor:e,themeName:e},s)===!1)throw new Error("Theme change cancelled by beforeChange hook");const i=c.applyTheme(e,{...r,prefix:r?.prefix||t.prefix,includeSemantics:r?.includeSemantics??t.includeSemantics,includeGrays:r?.includeGrays??t.includeGrays,nameMap:r?.nameMap||t.nameMap});return t.persistence&&(await p.setItem(t.storageKey,JSON.stringify(i)),await t.hooks?.onSave?.(i)),await t.hooks?.afterChange?.(i),i}catch(i){throw t.hooks?.onError?.(i),i}},k=async(e,r)=>{if(!o.find(s=>s.name===e))throw new Error(`Preset theme "${e}" not found`);return h(e,r)},w=`${t.storageKey}-custom-themes`,E=async()=>{try{const e=await p.getItem(w);e&&(JSON.parse(e).forEach(r=>{o.find(s=>s.name===r.name)||o.push({...r,custom:!0})}),o=d(o))}catch(e){t.hooks?.onError?.(e)}},v=async()=>{try{const e=o.filter(r=>r.custom);await p.setItem(w,JSON.stringify(e))}catch(e){t.hooks?.onError?.(e)}},I=async()=>{try{await E();const e=await p.getItem(t.storageKey);if(e){const r=JSON.parse(e);await h(r.themeName||r.primaryColor),await t.hooks?.onLoad?.(r)}else t.defaultTheme&&await h(t.defaultTheme)}catch(e){t.hooks?.onError?.(e)}},b=e=>{if(o.find(s=>s.name===e.name))throw new Error(`Theme "${e.name}" already exists`);const r={...e,custom:!0,order:e.order??Math.max(...o.map(s=>s.order??0))+1};o.push(r),o=d(o),v()},x=e=>{const r=o.findIndex(s=>s.name===e&&s.custom);if(r===-1)throw new Error(`Custom theme "${e}" not found`);o.splice(r,1),v()},M=()=>d(o),g=[],y={manager:c,presets:o,options:{...t,locale:n.value},currentLocale:n,localeMessages:m,applyTheme:h,applyPresetTheme:k,getCurrentTheme:()=>c.getCurrentTheme(),onChange:e=>{const r=c.onChange(e);return g.push(r),r},addCustomTheme:b,removeCustomTheme:x,getSortedPresets:M,destroy(){g.forEach(e=>e()),g.length=0,c.destroy&&c.destroy()},install(e){if(!S(a.locale)){const r=e._context?.provides?.locale;r&&r.value!==void 0||e.provide("locale",n)}if(e.provide(T,y),e.provide("color",y),e.provide("color-locale",m),e.config.globalProperties.$color=y,t.autoApply&&typeof window<"u"){const r=setTimeout(()=>{I()},0);g.push(()=>clearTimeout(r))}}};return y}exports.ColorPluginSymbol=T,exports.createColorPlugin=C,exports.default=C;/*! End of @ldesign/color | Powered by @ldesign/builder */
//# sourceMappingURL=index.cjs.map
